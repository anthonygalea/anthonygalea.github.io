<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en-us">
<head>
  <link href="http://gmpg.org/xfn/11" rel="profile">
  <meta http-equiv="content-type" content="text/html; charset=utf-8">

  
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">

  <title>An Introduction to Load Testing with Gatling</title>

  
  <link rel="stylesheet" href="http://www.anthony-galea.com/css/poole.min.css">
  
  <link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/font-awesome/4.5.0/css/font-awesome.min.css">
  <link href='https://fonts.googleapis.com/css?family=Lato' rel='stylesheet' type='text/css'>
  
  <link rel="apple-touch-icon-precomposed" sizes="144x144" href="http://www.anthony-galea.com/touch-icon-144-precomposed.png">
  

  
  
  
  

  <meta name="description" content="">
  <meta name="keywords" content="gatling,load,testing,tutorial,introduction">
  

  
  <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-38752250-1', 'auto');
    ga('send', 'pageview');
  </script>
  
</head>
<body>

<div class="navbar">
  <div class="container">
  <div class="title">
    <h1><a href="/">Anthony Galea</a></h1>
  </div>
  <div class="links">
    <ul>
      <li>
      <a href="https://github.com/anthonygalea" target="_blank"><i class="fa fa-github-square fa-1x"></i></a>
      
      
      <a href="https://at.linkedin.com/in/anthonygalea" target="_blank"><i class="fa fa-linkedin-square fa-1x"></i></a>
      
      
      
      
      <a href="mailto:anthony.galea@gmail.com" target="_blank"><i class="fa fa-envelope-square fa-1x"></i></a>
      <a href="http://www.anthony-galea.com/index.xml" type="application/rss+xml" target="_blank"><i class="fa fa-rss-square fa-1x"></i></a>
      </li>
    </ul>
  </div>
</div>
</div>



<div class="content">
  <div class="post">
    <div class="post-header">
      <h1 class="post-title">An Introduction to Load Testing with Gatling</h1>
      <span class="post-date">
      Jan 3, 2016 &middot; 3 minute read
      
      <a class="label" href="http://www.anthony-galea.com/categories/testing">testing</a><a class="label" href="http://www.anthony-galea.com/categories/http">http</a><a class="label" href="http://www.anthony-galea.com/categories/scala">scala</a>
      

      
      </span>
    </div>
    <div class="sect1">
<h2 id="_introduction">Introduction</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Many developers are familiar with the <a href="http://jmeter.apache.org/">Apache JMeter</a> or <a href="https://httpd.apache.org/docs/2.2/programs/ab.html">Apache Bench</a> tools for writing load tests. <a href="http://gatling.io">Gatling</a> is an alternative tool which provides:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>a concise Scala DSL in order to <a href="#describe">Describe a Load Test</a></p>
</li>
<li>
<p>a simple means to <a href="#run">Run a Simulation</a></p>
</li>
<li>
<p>a nice html <a href="#report">Report</a> with all the results</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="report">Report</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Let&#8217;s start by looking at the typical output of a Gatling load test. We have overall distribution of response time for the whole load test:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="/images/2016-01-03-gatling-global.png" alt="2016 01 03 gatling global">
</div>
</div>
<div class="paragraph">
<p>A more detailed response time distribution:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="/images/2016-01-03-gatling-response-distribution.png" alt="2016 01 03 gatling response distribution">
</div>
</div>
<div class="paragraph">
<p>Response time percentiles over the duration of the test:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="/images/2016-01-03-gatling-response-time.png" alt="2016 01 03 gatling response time">
</div>
</div>
<div class="paragraph">
<p>And number of requests per second over the duration of the test:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="/images/2016-01-03-gatling-requests-per-second.png" alt="2016 01 03 gatling requests per second">
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="describe">Describe a Load Test</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This is how we would write a simple load test which performs 50 <code>GET</code> requests against a server running at <code>test.com</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span class="tok-kd">class</span> <span class="tok-nc">SimpleSimulation</span> <span class="tok-kd">extends</span> <span class="tok-n">Simulation</span> <span class="tok-o">{</span>
  <span class="tok-c1">//declare a scenario with a simple get request performed 5 times</span>
  <span class="tok-n">val</span> <span class="tok-n">scn</span> <span class="tok-o">=</span> <span class="tok-n">scenario</span><span class="tok-o">(</span><span class="tok-s">&quot;myScenario&quot;</span><span class="tok-o">)</span>
            <span class="tok-o">.</span><span class="tok-na">exec</span><span class="tok-o">(</span><span class="tok-n">http</span><span class="tok-o">(</span><span class="tok-s">&quot;myRequest&quot;</span><span class="tok-o">).</span><span class="tok-na">get</span><span class="tok-o">(</span><span class="tok-s">&quot;http://test.com/page.html&quot;</span><span class="tok-o">))</span>
            <span class="tok-o">.</span><span class="tok-na">repeat</span><span class="tok-o">(</span><span class="tok-mi">5</span><span class="tok-o">)</span>

  <span class="tok-c1">//run the scenario with 10 concurrent users</span>
  <span class="tok-n">setUp</span><span class="tok-o">(</span><span class="tok-n">scn</span><span class="tok-o">.</span><span class="tok-na">users</span><span class="tok-o">(</span><span class="tok-mi">10</span><span class="tok-o">))</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Gatling refers to load tests as <code>Simulations</code> which have one or more <code>Scenarios</code>. In the one above we are saying we will have 10 users execute 5 requests each in parallel. We could provide a <code>Content-Type</code> header with the request and check for a <code>200</code> response code like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span class="tok-n">http</span><span class="tok-o">(</span><span class="tok-s">&quot;myRequest&quot;</span><span class="tok-o">)</span>
  <span class="tok-o">.</span><span class="tok-na">get</span><span class="tok-o">(</span><span class="tok-s">&quot;http://test.com/page.html&quot;</span><span class="tok-o">)</span>
  <span class="tok-o">.</span><span class="tok-na">header</span><span class="tok-o">(</span><span class="tok-s">&quot;Content-Type&quot;</span><span class="tok-o">,</span> <span class="tok-s">&quot;text/html&quot;</span><span class="tok-o">)</span>
  <span class="tok-o">.</span><span class="tok-na">check</span><span class="tok-o">(</span><span class="tok-n">status</span><span class="tok-o">.</span><span class="tok-na">is</span><span class="tok-o">(</span><span class="tok-mi">200</span><span class="tok-o">))</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>If we wanted to do a <code>POST</code> request with a JSON body and basic authentication, as well as verify something in the response:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span class="tok-n">http</span><span class="tok-o">(</span><span class="tok-s">&quot;myRequest&quot;</span><span class="tok-o">)</span>
  <span class="tok-o">.</span><span class="tok-na">post</span><span class="tok-o">(</span><span class="tok-s">&quot;http://test.com/someresource&quot;</span><span class="tok-o">))</span>
  <span class="tok-o">.</span><span class="tok-na">body</span><span class="tok-o">(</span><span class="tok-n">StringBody</span><span class="tok-o">(</span><span class="tok-s">&quot;&quot;&quot;{ &quot;</span><span class="tok-n">myContent</span><span class="tok-s">&quot;: &quot;</span><span class="tok-n">myValue</span><span class="tok-s">&quot; }&quot;&quot;&quot;</span><span class="tok-o">))</span>
  <span class="tok-o">.</span><span class="tok-na">asJSON</span>
  <span class="tok-o">.</span><span class="tok-na">basicAuth</span><span class="tok-o">(</span><span class="tok-s">&quot;username&quot;</span><span class="tok-o">,</span> <span class="tok-s">&quot;password&quot;</span><span class="tok-o">)</span>
  <span class="tok-o">.</span><span class="tok-na">check</span><span class="tok-o">(</span><span class="tok-n">jsonPath</span><span class="tok-o">(</span><span class="tok-s">&quot;$..someField&quot;</span><span class="tok-o">).</span><span class="tok-na">is</span><span class="tok-o">(</span><span class="tok-s">&quot;some value&quot;</span><span class="tok-o">))</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The expression used to extract <code>someField</code> from the response is passed to <code>jsonPath()</code> and is based on <a href="http://goessner.net/articles/JsonPath/">Goessner&#8217;s JsonPath syntax</a>. We use <code>is()</code> to verify the expected value is equal to <code>some value</code>. We can also do other forms of verification on the response json like:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>not(expectedValue)</code>: not equal to <code>expectedValue</code></p>
</li>
<li>
<p><code>in(sequence)</code>: to check that a value belongs to the given <code>sequence</code></p>
</li>
<li>
<p><code>exists()</code>, <code>notExists()</code>: to check for the presence/absence of a field</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>For a multipart request with 2 parts and gzip compression:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span class="tok-n">http</span><span class="tok-o">(</span><span class="tok-s">&quot;myRequest&quot;</span><span class="tok-o">)</span>
  <span class="tok-o">.</span><span class="tok-na">post</span><span class="tok-o">(</span><span class="tok-s">&quot;http://test.com/someresource&quot;</span><span class="tok-o">))</span>
  <span class="tok-o">.</span><span class="tok-na">bodyPart</span><span class="tok-o">(</span><span class="tok-n">StringBodyPart</span><span class="tok-o">(</span><span class="tok-s">&quot;&quot;&quot;{ &quot;</span><span class="tok-n">myContent</span><span class="tok-s">&quot;: &quot;</span><span class="tok-n">myValue</span><span class="tok-s">&quot; }&quot;&quot;&quot;</span><span class="tok-o">))</span>
  <span class="tok-o">.</span><span class="tok-na">bodyPart</span><span class="tok-o">(</span><span class="tok-n">RawFileBodyPart</span><span class="tok-o">(</span><span class="tok-s">&quot;file&quot;</span><span class="tok-o">,</span> <span class="tok-s">&quot;test.txt&quot;</span><span class="tok-o">)</span>
  <span class="tok-o">.</span><span class="tok-na">processRequestBody</span><span class="tok-o">(</span><span class="tok-n">gzipBody</span><span class="tok-o">)</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>We can also create scenarios with multiple requests and use the result from previous requests in subsequent requests like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span class="tok-n">scenario</span><span class="tok-o">(</span><span class="tok-s">&quot;myScenario&quot;</span><span class="tok-o">)</span>
  <span class="tok-o">.</span><span class="tok-na">exec</span><span class="tok-o">(</span><span class="tok-n">http</span><span class="tok-o">(</span><span class="tok-s">&quot;request1&quot;</span><span class="tok-o">)</span>
          <span class="tok-o">.</span><span class="tok-na">post</span><span class="tok-o">(</span><span class="tok-s">&quot;http://test.com/resource1&quot;</span><span class="tok-o">)</span>
          <span class="tok-o">.</span><span class="tok-na">body</span><span class="tok-o">(</span><span class="tok-n">StringBody</span><span class="tok-s">&quot;&quot;&quot;{ &quot;</span><span class="tok-n">myContent</span><span class="tok-s">&quot;: &quot;&quot;}&quot;&quot;&quot;</span><span class="tok-o">)</span>
          <span class="tok-o">.</span><span class="tok-na">check</span><span class="tok-o">(</span><span class="tok-n">jsonPath</span><span class="tok-o">(</span><span class="tok-s">&quot;$..myResponse.guid&quot;</span><span class="tok-o">).</span><span class="tok-na">saveAs</span><span class="tok-o">(</span><span class="tok-s">&quot;guid&quot;</span><span class="tok-o">)))</span>
  <span class="tok-o">.</span><span class="tok-na">exec</span><span class="tok-o">(</span><span class="tok-n">http</span><span class="tok-o">(</span><span class="tok-s">&quot;request2&quot;</span><span class="tok-o">)</span>
          <span class="tok-o">.</span><span class="tok-na">put</span><span class="tok-o">(</span><span class="tok-s">&quot;http://test.com/resource2/${guid}&quot;</span><span class="tok-o">)</span>
          <span class="tok-o">.</span><span class="tok-na">body</span><span class="tok-o">(</span><span class="tok-n">StringBody</span><span class="tok-s">&quot;&quot;&quot;{ &quot;</span><span class="tok-n">someOtherField</span><span class="tok-s">&quot;: &quot;&quot;}&quot;&quot;&quot;</span><span class="tok-o">))</span></code></pre>
</div>
</div>
<div class="paragraph">
<p><code>guid</code> is extracted from the response of the first call using <code>saveAs("guid")</code> and used in the path to the <code>PUT</code> call.</p>
</div>
<div class="paragraph">
<p>Scenarios can also be run with a ramp up. If we wanted to run the scenario above with 1000 users with a ramp up of 20 seconds we would do:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span class="tok-n">setUp</span><span class="tok-o">(</span><span class="tok-n">scn</span><span class="tok-o">.</span><span class="tok-na">users</span><span class="tok-o">(</span><span class="tok-mi">1000</span><span class="tok-o">).</span><span class="tok-na">ramp</span><span class="tok-o">(</span><span class="tok-mi">20</span><span class="tok-o">))</span></code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="run">Run a Simulation</h2>
<div class="sectionbody">
<div class="paragraph">
<p>There are a number of ways to run Gatling simulations. You can <a href="http://gatling.io/#/download">download the bundle</a>, place your simulations under the <code>user-files/simulations</code> directory and then run <code>bin/gatling.sh</code>.</p>
</div>
<div class="paragraph">
<p>If you prefer integration with your build system there are plugins for <a href="http://gatling.io/docs/2.1.7/extensions/maven_plugin.html">Maven</a>, <a href="https://github.com/alphagov/gradle-gatling-plugin">Gradle</a> and <a href="http://gatling.io/docs/2.1.7/extensions/sbt_plugin.html">SBT</a>. For example, for Maven we just add the dependencies in the <code>pom.xml</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><span class="tok-nt">&lt;dependencies&gt;</span>
  <span class="tok-nt">&lt;dependency&gt;</span>
    <span class="tok-nt">&lt;groupId&gt;</span>io.gatling.highcharts<span class="tok-nt">&lt;/groupId&gt;</span>
    <span class="tok-nt">&lt;artifactId&gt;</span>gatling-charts-highcharts<span class="tok-nt">&lt;/artifactId&gt;</span>
    <span class="tok-nt">&lt;scope&gt;</span>test<span class="tok-nt">&lt;/scope&gt;</span>
  <span class="tok-nt">&lt;/dependency&gt;</span>
<span class="tok-nt">&lt;/dependencies&gt;</span>

<span class="tok-nt">&lt;build&gt;</span>
   <span class="tok-nt">&lt;plugins&gt;</span>
     <span class="tok-nt">&lt;plugin&gt;</span>
       <span class="tok-nt">&lt;groupId&gt;</span>io.gatling<span class="tok-nt">&lt;/groupId&gt;</span>
       <span class="tok-nt">&lt;artifactId&gt;</span>gatling-maven-plugin<span class="tok-nt">&lt;/artifactId&gt;</span>
     <span class="tok-nt">&lt;/plugin&gt;</span>
   <span class="tok-nt">&lt;/plugins&gt;</span>
<span class="tok-nt">&lt;/build&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Place simulations under <code>src/test/scala/com/company/service</code> and then in the terminal:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="bash">mvn gatling:execute -Dgatling.simulationClass<span class="tok-o">=</span>com.company.service.YourSimulation</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_conclusion">Conclusion</h2>
<div class="sectionbody">
<div class="paragraph">
<p>I have found Gatling to be a very effective tool for load testing. The DSL is succinct and the reports generated provide all the information typically needed out of the box. Other alternatives which I have not yet experimented with are:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://github.com/newsapps/beeswithmachineguns">Bees with Machine Guns</a></p>
</li>
<li>
<p><a href="http://locust.io/">Locust</a></p>
</li>
</ul>
</div>
</div>
</div>


    <div class="post-footer">
      <div class="paragraph">
        
        <a href="/">← Blog</a>
        
        
        <a class="pull-right" href="http://www.anthony-galea.com/blog/post/the-builder-pattern-in-java/">Next Post →</a>
        
      </div>

    
    
    
    
      
      
      
    
      
      
      
    
      
      
      
    
      
      
      
    
      
      
      
    
      
      
      
    
      
      
      
    
      
      
      
    
      
      
      
    
      
      
      
    
      
      
      
    
      
      
      
    

    
  

</div>




</div>
<footer>
  <div class="paragraph">
    <ul>
      <li>
      <a href="https://github.com/anthonygalea" target="_blank">GitHub</i></a> |
      
      
      <a href="https://at.linkedin.com/in/anthonygalea" target="_blank">LinkedIn</a> |
      
      
      
      
      <a href="mailto:anthony.galea@gmail.com" target="_blank">Contact</a> |
      <a href="http://www.anthony-galea.com/index.xml" type="application/rss+xml" target="_blank">RSS Feed</a>
      </li>
    </ul>
  </div>
</footer>


<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.5.3/MathJax.js?config=TeX-MML-AM_HTMLorMML" type="text/javascript"></script>
<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  tex2jax: {
    inlineMath: [["\\(", "\\)"]],
    displayMath: [["\\[", "\\]"]],
    ignoreClass: "nostem|nolatexmath"
  },
  asciimath2jax: {
    delimiters: [["\\$", "\\$"]],
    ignoreClass: "nostem|noasciimath"
  },
  TeX: { equationNumbers: { autoNumber: "none" } }
});
</script>
</body>
</html>

